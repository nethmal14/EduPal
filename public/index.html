<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>AURA ELITE</title>
    <style>
        :root {
            --bg: #050505;
            --accent: #ffffff;
            --glass: rgba(12, 12, 12, 0.65);
            --border: rgba(255, 255, 255, 0.07);
            --text-main: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.35);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg);
            color: var(--text-main);
            font-family: -apple-system, "SF Pro Display", "Helvetica Neue", sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #canvas-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
        }

        .app-shell {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px;
            pointer-events: none;
        }

        .app-shell * { pointer-events: auto; }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 6px;
        }

        .brand {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 6px;
            text-transform: uppercase;
            opacity: 0.4;
        }

        .btn-ghost {
            background: transparent;
            border: none;
            color: white;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.4;
            transition: opacity 0.3s ease;
        }
        .btn-ghost:hover, .btn-ghost:active { opacity: 1; }

        .bottom-anchor {
            width: 100%;
            max-width: 460px;
            align-self: center;
            padding-bottom: 30px;
        }

        .main-controller {
            background: var(--glass);
            border: 1px solid var(--border);
            backdrop-filter: blur(40px) saturate(1.5);
            border-radius: 32px;
            padding: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
        }

        .info-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 20px;
            padding: 0 6px;
        }

        .track-info { flex: 1; overflow: hidden; padding-right: 20px; }
        .track-info h2 {
            font-size: 14px;
            font-weight: 500;
            letter-spacing: -0.2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .track-info p {
            font-size: 9px;
            color: var(--text-dim);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .scrub-container { margin-bottom: 24px; padding: 0 6px; }
        .track-base {
            height: 1.5px;
            background: rgba(255,255,255,0.05);
            border-radius: 1px;
            width: 100%;
            position: relative;
            cursor: pointer;
        }

        .track-progress {
            position: absolute;
            height: 100%;
            background: var(--accent);
            width: 0%;
            border-radius: 1px;
            transition: width 0.1s linear;
        }

        .controls-grid {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }

        .btn-nav {
            background: transparent;
            border: none;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        .btn-nav svg { fill: white; width: 16px; height: 16px; }

        .btn-play {
            background: white;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(255,255,255,0.08);
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-play:active { transform: scale(0.92); }
        .btn-play svg { fill: black; width: 18px; height: 18px; transform: translateX(1px); }

        .panel {
            position: fixed;
            inset: 0;
            background: rgba(5,5,5,0.98);
            z-index: 100;
            transform: translateY(100%);
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            padding: 60px 30px;
            backdrop-filter: blur(20px);
        }

        .panel.active { transform: translateY(0); }
        .panel-header { margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .panel-header h1 { font-size: 18px; font-weight: 300; letter-spacing: 1px; text-transform: uppercase; }

        .editor-group { margin-bottom: 30px; }
        .editor-group label {
            display: block;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            color: var(--text-dim);
            margin-bottom: 12px;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            max-height: 45vh;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .preset-btn {
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            padding: 18px 10px;
            border-radius: 16px;
            font-size: 11px;
            color: var(--text-dim);
            text-align: center;
            transition: all 0.3s ease;
        }

        .preset-btn.active {
            border-color: #555;
            color: #fff;
            background: #151515;
        }

        input[type="range"] {
            width: 100%;
            height: 1px;
            background: #222;
            appearance: none;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            border: 2px solid #000;
        }

        .list-scroll { height: 70vh; overflow-y: auto; padding-right: 10px; }
        .track-item {
            padding: 20px 4px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .track-item.active .name { color: var(--accent); }
        .track-item .name { font-size: 13px; font-weight: 400; color: var(--text-dim); transition: color 0.3s; }
        .track-item .size { font-size: 9px; color: var(--text-dim); opacity: 0.5; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <div class="app-shell">
        <header>
            <div class="brand">AURA ELITE</div>
            <button class="btn-ghost" onclick="togglePanel('visuals')">
                <svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:currentColor"><path d="M12 15.5A3.5 3.5 0 1 1 15.5 12 3.5 3.5 0 0 1 12 15.5m0-9A5.5 5.5 0 1 0 17.5 12 5.5 5.5 0 0 0 12 6.5M3 13h2v-2H3v2m16 0h2v-2h-2v2m-8 6h2v-2h-2v2m0-16h2V3h-2v2"/></svg>
            </button>
        </header>

        <div class="bottom-anchor">
            <div class="main-controller">
                <div class="info-section" onclick="togglePanel('playlist')">
                    <div class="track-info">
                        <h2 id="t-name">Quiescent</h2>
                        <p id="t-sub">Ready to Stream</p>
                    </div>
                    <div style="font-size:9px; color:var(--text-dim); letter-spacing:1px; font-variant-numeric: tabular-nums;" id="t-time">0:00</div>
                </div>

                <div class="scrub-container" onclick="seek(event)">
                    <div class="track-base">
                        <div class="track-progress" id="prog"></div>
                    </div>
                </div>

                <div class="controls-grid">
                    <button class="btn-nav" onclick="togglePanel('playlist')">
                        <svg viewBox="0 0 24 24"><path d="M3 15h18v-2H3v2m0 4h18v-2H3v2m0-8h18V9H3v2m0-4h18V5H3v2"/></svg>
                    </button>
                    <button class="btn-nav" onclick="prev()">
                        <svg viewBox="0 0 24 24"><path d="M6 18V6h2v12H6zm3.5-6L18 18V6l-8.5 6z"/></svg>
                    </button>
                    <button class="btn-play" onclick="togglePlay()">
                        <svg id="p-svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                    <button class="btn-nav" onclick="next()">
                        <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
                    </button>
                    <button class="btn-nav" onclick="document.getElementById('f').click()">
                        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Visual Editor -->
    <div id="panel-visuals" class="panel">
        <div class="panel-header">
            <h1>Environment</h1>
            <button class="btn-ghost" onclick="togglePanel('visuals')" style="opacity:1">Close</button>
        </div>
        
        <div class="editor-group">
            <label>Visual Mode</label>
            <div class="preset-grid" id="preset-grid">
                <div class="preset-btn active" onclick="setMode(0, this)">Silk Flow</div>
                <div class="preset-btn" onclick="setMode(1, this)">Nebula Mist</div>
                <div class="preset-btn" onclick="setMode(2, this)">Glass Refraction</div>
                <div class="preset-btn" onclick="setMode(3, this)">Luminous Web</div>
                <div class="preset-btn" onclick="setMode(4, this)">Liquid Mercury</div>
                <div class="preset-btn" onclick="setMode(5, this)">Celestial Bloom</div>
                <div class="preset-btn" onclick="setMode(6, this)">Infinite Horizon</div>
                <div class="preset-btn" onclick="setMode(7, this)">Crystal Lattice</div>
            </div>
        </div>

        <div class="editor-group">
            <label>Luminance</label>
            <input type="range" min="0.1" max="3" step="0.01" value="1.0" oninput="uParams.color = this.value">
        </div>

        <div class="editor-group">
            <label>Flow Rate</label>
            <input type="range" min="0.1" max="4" step="0.01" value="1.0" oninput="uParams.dist = this.value">
        </div>
    </div>

    <!-- Library -->
    <div id="panel-playlist" class="panel">
        <div class="panel-header">
            <h1>Library</h1>
            <button class="btn-ghost" onclick="togglePanel('playlist')" style="opacity:1">Close</button>
        </div>
        <div class="list-scroll" id="list"></div>
    </div>

    <input type="file" id="f" class="hidden" webkitdirectory directory multiple>

    <script>
        const canvas = document.getElementById('canvas-bg');
        const gl = canvas.getContext('webgl');
        const audio = new Audio();
        let aCtx, analyser, data, playlist = [], curIdx = -1;
        let uParams = { color: 1.0, dist: 1.0 };

        // --- ELEGANT CINEMATIC SHADER LIBRARY ---
        const MODES = [
            `void mainImage(out vec4 O, vec2 C){
                vec2 u = (C-.5*iResolution.xy)/iResolution.y;
                float t = iTime * 0.2 * uParams.y;
                float b = uAudio.x * 0.5;
                for(float i=1.0; i<4.0; i++){
                    u.x += 0.3/i * sin(i*u.y + t + b);
                    u.y += 0.3/i * cos(i*u.x + t + b);
                }
                vec3 col = vec3(0.1, 0.12, 0.15) / length(u);
                col *= vec3(0.8, 0.9, 1.0) * uParams.x;
                O = vec4(pow(col, vec3(1.2)), 1.0);
            }`,
            `void mainImage(out vec4 O, vec2 C){
                vec2 u = (C-.5*iResolution.xy)/iResolution.y;
                float b = uAudio.x * uParams.x;
                float d = length(u);
                float s = sin(d * 4.0 - iTime * 0.5 + b * 2.0);
                vec3 col = mix(vec3(0.02, 0.05, 0.1), vec3(0.4, 0.2, 0.5), smoothstep(-1.0, 1.0, s));
                col += (0.05 + b * 0.1) / d;
                O = vec4(col * uParams.x, 1.0);
            }`,
            `void mainImage(out vec4 O, vec2 C){
                vec2 u = (C-.5*iResolution.xy)/iResolution.y;
                float t = iTime * 0.3 * uParams.y;
                float b = uAudio.x;
                vec3 col = vec3(0.0);
                for(float i=0.0; i<6.0; i++){
                    vec2 p = vec2(sin(t + i*1.4), cos(t*0.8 + i*2.1)) * 0.4;
                    float r = 0.1 + b * 0.2;
                    col += 0.002 / abs(length(u - p) - r) * vec3(0.5, 0.7, 1.0);
                }
                O = vec4(col * uParams.x, 1.0);
            }`,
            `void mainImage(out vec4 O, vec2 C){
                vec2 u = (C-.5*iResolution.xy)/iResolution.y * 2.0;
                float t = iTime * 0.15 * uParams.y;
                float b = uAudio.x;
                float v = 0.0;
                for(float i=1.0; i<5.0; i++){
                    u.x += sin(u.y + t + i) * 0.5;
                    u.y += cos(u.x + t + i) * 0.5;
                    v += 0.005 / abs(u.x + u.y);
                }
                O = vec4(vec3(v * uParams.x) * vec3(0.6, 0.8, 1.0), 1.0);
            }`,
            // Liquid Mercury: High-reflectivity viscous fluid
            `void mainImage(out vec4 O, vec2 C){
                vec2 u = (C-.5*iResolution.xy)/iResolution.y;
                float t = iTime * 0.4 * uParams.y;
                float b = uAudio.x * 0.8;
                vec2 p = u;
                for(int i=1; i<5; i++){
                    float fi = float(i);
                    p += cos(p.yx * fi + t + b) / fi;
                }
                float h = sin(p.x + p.y);
                vec3 col = vec3(0.2) + 0.8 * vec3(h);
                col += vec3(0.4, 0.5, 0.6) * pow(h, 10.0);
                O = vec4(col * uParams.x, 1.0);
            }`,
            // Celestial Bloom: Radial soft particle diffusion
            `void mainImage(out vec4 O, vec2 C){
                vec2 u = (C-.5*iResolution.xy)/iResolution.y;
                float b = uAudio.x;
                vec3 col = vec3(0.0);
                for(float i=0.0; i<40.0; i++){
                    float a = i * 0.1618 + iTime * 0.1;
                    float r = sqrt(i) * 0.15;
                    vec2 p = vec2(cos(a), sin(a)) * r;
                    float d = length(u - p);
                    col += 0.001 / (d * d + 0.001) * (0.5 + 0.5*cos(i + vec3(0,2,4)));
                }
                O = vec4(col * (0.3 + b) * uParams.x, 1.0);
            }`,
            // Infinite Horizon: Ethereal grid with depth
            `void mainImage(out vec4 O, vec2 C){
                vec2 u = (C-.5*iResolution.xy)/iResolution.y;
                float b = uAudio.x * 0.4;
                float t = iTime * 0.5 * uParams.y;
                u.y += 0.2;
                float z = 1.0 / (abs(u.y) + 0.01);
                vec2 uv = vec2(u.x * z, z + t);
                float grid = smoothstep(0.45, 0.5, abs(fract(uv.x * 2.0) - 0.5)) + 
                             smoothstep(0.45, 0.5, abs(fract(uv.y * 2.0) - 0.5));
                vec3 col = mix(vec3(0.0), vec3(0.1, 0.3, 0.6), grid / z);
                col *= (1.0 + b * 5.0);
                O = vec4(col * uParams.x, 1.0);
            }`,
            // Crystal Lattice: Geometric light refraction
            `void mainImage(out vec4 O, vec2 C){
                vec2 u = (C-.5*iResolution.xy)/iResolution.y * 1.5;
                float b = uAudio.x;
                float t = iTime * 0.3;
                float d = 1e9;
                for(int i=0; i<8; i++){
                    vec2 p = vec2(sin(t + float(i)*1.5), cos(t*0.7 + float(i)*2.0));
                    d = min(d, length(u - p));
                }
                vec3 col = vec3(0.02 / d) * vec3(0.7, 0.85, 1.0);
                col += smoothstep(0.1, 0.0, d - (0.05 + b*0.1)) * 0.5;
                O = vec4(col * uParams.x, 1.0);
            }`
        ];

        function initA() {
            if (aCtx) return;
            aCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = aCtx.createAnalyser(); analyser.fftSize = 512;
            const s = aCtx.createMediaElementSource(audio);
            s.connect(analyser); analyser.connect(aCtx.destination);
            data = new Uint8Array(analyser.frequencyBinCount);
        }

        function play(i) {
            initA(); if (i<0 || i>=playlist.length) return;
            curIdx=i; audio.src=URL.createObjectURL(playlist[i].file); audio.play();
            document.getElementById('t-name').innerText=playlist[i].name.split('.')[0];
            document.getElementById('t-sub').innerText="Now Playing";
            updateUI();
        }

        function togglePlay() {
            if (curIdx===-1) return document.getElementById('f').click();
            if (audio.paused) { aCtx?.resume(); audio.play(); } else { audio.pause(); }
            updateUI();
        }

        function updateUI() {
            document.getElementById('p-svg').innerHTML = audio.paused ? '<path d="M8 5v14l11-7z"/>' : '<path d="M6 19h2V5H6v14zm10-14v14h2V5h-2z"/>';
            const list = document.getElementById('list'); list.innerHTML = '';
            playlist.forEach((t, i) => {
                const d = document.createElement('div');
                d.className = `track-item ${i===curIdx?'active':''}`;
                d.innerHTML = `<span class="name">${t.name.split('.')[0]}</span><span class="size">${(t.file.size/1024/1024).toFixed(1)}MB</span>`;
                d.onclick = () => { play(i); togglePanel('playlist'); };
                list.appendChild(d);
            });
        }

        function next() { play((curIdx+1)%playlist.length); }
        function prev() { play((curIdx-1+playlist.length)%playlist.length); }
        function seek(e) { audio.currentTime = (e.offsetX / e.currentTarget.clientWidth) * audio.duration; }

        audio.ontimeupdate = () => { 
            document.getElementById('prog').style.width = (audio.currentTime/audio.duration*100)+'%';
            let m = Math.floor(audio.currentTime / 60), s = Math.floor(audio.currentTime % 60);
            document.getElementById('t-time').innerText = `${m}:${s<10?'0':''}${s}`;
        };
        audio.onended = next;

        document.getElementById('f').onchange = e => {
            const files = Array.from(e.target.files).filter(f => f.type.startsWith('audio/'));
            if (files.length) { playlist = files.map(f => ({ name: f.name, file: f })); play(0); }
        };

        function togglePanel(id) { document.getElementById('panel-'+id).classList.toggle('active'); }

        let prog, mIdx = 0, start = Date.now();
        function setProg(i) {
            const vs = gl.createShader(gl.VERTEX_SHADER); gl.shaderSource(vs, `attribute vec2 p; void main(){gl_Position=vec4(p,0,1);}`); gl.compileShader(vs);
            const fs = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(fs, `precision highp float; uniform vec2 iResolution; uniform float iTime; uniform vec2 uAudio; uniform vec2 uParams; ${MODES[i]} void main(){mainImage(gl_FragColor,gl_FragCoord.xy);}`); gl.compileShader(fs);
            prog = gl.createProgram(); gl.attachShader(prog, vs); gl.attachShader(prog, fs); gl.linkProgram(prog); gl.useProgram(prog);
            const b = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, b);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]), gl.STATIC_DRAW);
            const p = gl.getAttribLocation(prog, "p"); gl.enableVertexAttribArray(p); gl.vertexAttribPointer(p, 2, gl.FLOAT, 0, 0, 0);
        }

        function setMode(i, el) {
            mIdx = i; setProg(i);
            document.querySelectorAll('.preset-btn').forEach(m => m.classList.remove('active'));
            el.classList.add('active');
        }

        function loop() {
            gl.viewport(0, 0, canvas.width = window.innerWidth, canvas.height = window.innerHeight);
            let b = 0; if (analyser && !audio.paused) {
                analyser.getByteFrequencyData(data);
                for(let i=2; i<12; i++) b += data[i];
                b /= (10 * 255);
            }
            gl.useProgram(prog);
            gl.uniform2f(gl.getUniformLocation(prog, "iResolution"), canvas.width, canvas.height);
            gl.uniform1f(gl.getUniformLocation(prog, "iTime"), (Date.now()-start)/1000);
            gl.uniform2f(gl.getUniformLocation(prog, "uAudio"), b, 0);
            gl.uniform2f(gl.getUniformLocation(prog, "uParams"), uParams.color, uParams.dist);
            gl.drawArrays(gl.TRIANGLES, 0, 6);
            requestAnimationFrame(loop);
        }

        setProg(0); loop();
    </script>
</body>
</html>
